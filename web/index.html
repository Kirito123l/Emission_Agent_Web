<!DOCTYPE html>

<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Emission Agent</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&amp;display=swap" rel="stylesheet" />
    <!-- Material Symbols -->
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <!-- Marked.js for Markdown (æœ¬åœ°ç‰ˆæœ¬) -->
    <script src="marked.min.js"></script>
    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- Theme Config -->
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#10b77f",
                        "primary-dark": "#059669",
                        "background-light": "#f6f8f7",
                        "background-dark": "#10221c",
                        "surface": "#ffffff",
                    },
                    fontFamily: {
                        "display": ["Manrope", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "0.75rem",
                        "xl": "1rem",
                        "2xl": "1.5rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        /* Custom scrollbar for webkit */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #e5e7eb;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #d1d5db;
        }

        /* Ensure message list leaves room for fixed input area */
        /* REMOVED: max-width and centering - scrollbar must be at viewport edge */
        /* Messages themselves are centered, not the container */

        /* Align input area - content centered, not container */
        /* Input wrapper inside handles the centering */

        /* Markdown styling for assistant messages */
        .prose h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }

        .dark .prose h1 {
            color: #f1f5f9;
        }

        .prose h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
            margin-top: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .dark .prose h2 {
            color: #f1f5f9;
        }

        .prose h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e293b;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            padding-bottom: 0.375rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .dark .prose h3 {
            color: #f1f5f9;
            border-bottom-color: #475569;
        }

        .prose p {
            color: #475569;
            margin-bottom: 1rem;
            line-height: 1.75;
        }

        .dark .prose p {
            color: #cbd5e1;
        }

        .prose strong {
            font-weight: 600;
            color: #059669;
        }

        .dark .prose strong {
            color: #10b981;
        }

        .prose ul,
        .prose ol {
            list-style-position: outside;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .prose ul {
            list-style-type: disc;
        }

        .prose ol {
            list-style-type: decimal;
        }

        .prose li {
            color: #475569;
            margin-bottom: 0.5rem;
            line-height: 1.6;
        }

        .dark .prose li {
            color: #cbd5e1;
        }

        .prose code {
            padding: 0.125rem 0.375rem;
            background-color: #f1f5f9;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            font-family: ui-monospace, monospace;
        }

        .dark .prose code {
            background-color: #334155;
            color: #e2e8f0;
        }

        .prose table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .prose th {
            padding: 0.75rem 1rem;
            background-color: #f8fafc;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #e2e8f0;
        }

        .dark .prose th {
            background-color: #1e293b;
            border-bottom-color: #475569;
        }

        .prose td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #f1f5f9;
        }

        .dark .prose td {
            border-bottom-color: #334155;
        }

        /* åˆ†éš”çº¿æ ·å¼ */
        .prose hr {
            border: none;
            border-top: 2px solid #e5e7eb;
            margin: 2rem 0;
        }

        .dark .prose hr {
            border-top-color: #475569;
        }

        /* å¼•ç”¨å—æ ·å¼ */
        .prose blockquote {
            border-left: 4px solid #059669;
            padding-left: 1rem;
            margin: 1rem 0;
            color: #64748b;
            font-style: italic;
        }

        .dark .prose blockquote {
            border-left-color: #10b981;
            color: #94a3b8;
        }

        /* è­¦å‘Š/æç¤ºæ ·å¼ */
        .prose p:has(> :first-child:is(âš ï¸, â„¹ï¸, âœ…, âŒ)) {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            background-color: #fef3c7;
            border-left: 4px solid #f59e0b;
        }

        .dark .prose p:has(> :first-child:is(âš ï¸, â„¹ï¸, âœ…, âŒ)) {
            background-color: #78350f;
            border-left-color: #fbbf24;
        }

        .dark .prose td {
            border-bottom-color: #334155;
        }

        .prose tr:hover {
            background-color: #f8fafc;
        }

        .dark .prose tr:hover {
            background-color: #1e293b;
        }

        /* Remove scrollbar from input area */
        #input-area {
            overflow: visible;
        }

        /* Textarea auto-height */
        #message-input {
            overflow-y: hidden;
        }

        /* Typing indicator */
        .typing-indicator {
            padding: 8px 16px;
            color: #666;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
        }

        .dark .typing-indicator {
            color: #94a3b8;
        }

        .typing-indicator::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #3b82f6;
            border-radius: 50%;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }

        /* ================================================================
           ChatGPT-Style UI Enhancements
           Added: 2026-02-03
           Updated: 2026-02-03 - Fixed scrollbar positioning to right edge
           ================================================================ */

        /* 1. Page background - light gray for depth */
        body {
            background-color: #f7f7f8 !important;
        }

        /* 2. Main chat area background - NO PADDING */
        main {
            background-color: #f7f7f8 !important;
            padding: 0 !important;
            margin: 0 !important;
        }

        /* 3. Sidebar styling */
        aside {
            background-color: #ffffff !important;
        }

        /* 4. Messages container - CRITICAL: No padding/margin for scrollbar alignment */
        #messages-container {
            padding: 0 !important;
            margin: 0 !important;
            width: 100% !important;
            box-sizing: border-box !important;
            padding-top: 2rem !important;
            padding-bottom: 10rem !important;
            scroll-behavior: smooth !important;
        }

        :root {
            --chat-max-width: 60rem;
        }

        /* 5. Message wrapper - centered with responsive margins (increased width) */
        #messages-container > div {
            max-width: var(--chat-max-width) !important;
            margin-left: auto !important;
            margin-right: auto !important;
            margin-top: 0 !important;
            margin-bottom: 1.75rem !important;
            padding-left: 1rem !important;
            padding-right: 1rem !important;
        }

        @media (min-width: 768px) {
            #messages-container > div {
                padding-left: 2rem !important;
                padding-right: 2rem !important;
            }
        }

        /* 6. Last message extra bottom margin */
        #messages-container > div:last-child {
            margin-bottom: 2.25rem !important;
        }

        /* 7. AI message cards - enhanced elevation */
        .flex.justify-start {
            width: 100% !important;
        }

        .flex.justify-start > div:last-child > div {
            background-color: #ffffff !important;
            border: 1px solid rgba(0, 0, 0, 0.05) !important;
            border-radius: 12px !important;
            padding: 1.5rem !important;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08) !important;
        }

        /* 8. Dark mode AI message cards */
        .dark .flex.justify-start > div:last-child > div {
            background-color: #1e293b !important;
            border: 1px solid rgba(255, 255, 255, 0.05) !important;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) !important;
        }

        /* 9. User message bubbles - styling */
        .flex.justify-end {
            width: 100% !important;
        }

        .flex.justify-end .bg-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.25) !important;
            padding: 1rem 1.25rem !important;
        }

        /* 10. Input area alignment - match message width and padding */
        #input-area {
            background: linear-gradient(to top, #f7f7f8 0%, #f7f7f8 70%, transparent 100%) !important;
            padding-left: 1rem !important;
            padding-right: 1rem !important;
        }

        @media (min-width: 768px) {
            #input-area {
                padding-left: 2rem !important;
                padding-right: 2rem !important;
            }
        }

        /* 11. Input wrapper - match message max-width */
        #input-area .max-w-4xl {
            max-width: var(--chat-max-width) !important;
        }

        @media (min-width: 1536px) {
            :root {
                --chat-max-width: 64rem;
            }
        }

        /* 12. Enhanced table styling within messages */
        .prose table {
            background: #ffffff !important;
            border: 1px solid #e5e5e5 !important;
            border-radius: 0.5rem !important;
            overflow: hidden !important;
        }

        .prose th {
            background: #f9fafb !important;
            border-bottom: 1px solid #e5e5e5 !important;
            font-weight: 600 !important;
        }

        .prose td {
            border-bottom: 1px solid #f3f4f6 !important;
        }

        .prose tr:last-child td {
            border-bottom: none !important;
        }

        /* 13. Dark mode table styling */
        .dark .prose table {
            background: #1e293b !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        .dark .prose th {
            background: #0f172a !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        .dark .prose td {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;
        }

        /* 14. Loading message styling */
        .loading-message > div:last-child {
            background-color: #ffffff !important;
            border: 1px solid rgba(0, 0, 0, 0.05) !important;
            border-radius: 12px !important;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08) !important;
        }

        .dark .loading-message > div:last-child {
            background-color: #1e293b !important;
            border: 1px solid rgba(255, 255, 255, 0.05) !important;
        }

        /* 15. Better spacing for message content */
        .prose {
            line-height: 1.7 !important;
        }

        .prose p {
            margin-bottom: 1rem !important;
        }

        .prose ul, .prose ol {
            margin-bottom: 1rem !important;
        }

        /* 16. Header stays white */
        header {
            background-color: #ffffff !important;
        }

        /* 17. Enhanced scrollbar styling */
        #messages-container::-webkit-scrollbar {
            width: 8px;
        }

        #messages-container::-webkit-scrollbar-track {
            background: transparent;
        }

        #messages-container::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 4px;
        }

        #messages-container::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        .dark #messages-container::-webkit-scrollbar-thumb {
            background: #475569;
        }

        .dark #messages-container::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* 17. Smooth scroll behavior */
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark text-slate-800 dark:text-slate-100 font-display h-screen flex flex-col overflow-hidden">
    <!-- Top Navbar -->
    <header
        class="h-14 bg-surface dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 flex items-center justify-between px-6 shrink-0 z-20">
        <div class="flex items-center gap-3">
            <h1 class="text-[#0d1b17] dark:text-white text-lg font-bold tracking-tight flex items-center gap-2">
                <span class="text-2xl">ðŸŒ¿</span> æŽ’æ”¾è®¡ç®—åŠ©æ‰‹
            </h1>
        </div>
        <div class="flex items-center gap-4">
            <button
                class="p-2 text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors">
                <span class="material-symbols-outlined" style="font-size: 20px;">notifications</span>
            </button>
            <div
                class="flex items-center gap-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 py-1 px-2 rounded-lg transition-colors">
                <div class="bg-center bg-no-repeat bg-cover rounded-full size-8 border border-slate-200"
                    data-alt="User profile avatar showing a generic silhouette"
                    style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDYe6LexVGPu-ZT945aVcas_ngXGBWnohNLnPlDvgf8gf-IJvX-bzsJH7Z4riLqU94k51yiWvwdQyIz1Hf4YZgBrBGmYAXyVP5Zg7yhVFap-ksMeTxOTpOGhp8affT-g1uJzOf-26rBhHepY_0eWkpsy_naeLi7FYtx7hTEIH7THO6j9o-0Mekw1haEB5u1fZ2UohtxDQR-snmMl2Pbzxu_eBDQU3j0C_U5wIr38RYN_8NYD2teQMMXXE0QAZ72qFXcbz19zlig2rha");'>
                </div>
                <span id="user-display-name" class="text-sm font-medium hidden sm:block">ç”¨æˆ·</span>
            </div>
        </div>
    </header>
    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar -->
        <aside
            class="w-[280px] bg-[#f9fafb] dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 flex flex-col shrink-0 hidden md:flex z-10">
            <div class="p-4">
                <button
                    class="flex w-full items-center justify-center gap-2 rounded-lg h-10 bg-primary hover:bg-primary-dark text-white text-sm font-bold shadow-sm transition-all shadow-green-200/50">
                    <span class="material-symbols-outlined" style="font-size: 20px;">add</span>
                    <span>New Calculation</span>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto px-3 py-2 space-y-6">
                <!-- Recent History -->
                <div class="flex flex-col gap-1">
                    <h3 class="px-3 text-xs font-semibold text-slate-400 uppercase tracking-wider mb-1">Recent</h3>
                    <a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-white dark:bg-slate-800 shadow-sm border border-slate-100 dark:border-slate-700"
                        href="#">
                        <span class="material-symbols-outlined text-primary" style="font-size: 20px;">chat_bubble</span>
                        <p class="text-sm font-medium truncate">Factory Q3 Emissions</p>
                    </a>
                    <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 transition-colors"
                        href="#">
                        <span class="material-symbols-outlined" style="font-size: 20px;">history</span>
                        <p class="text-sm font-medium truncate">Shanghai Logistics 2023</p>
                    </a>
                    <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 transition-colors"
                        href="#">
                        <span class="material-symbols-outlined" style="font-size: 20px;">history</span>
                        <p class="text-sm font-medium truncate">New Energy Project</p>
                    </a>
                </div>
                <!-- Quick Tools -->
                <div class="flex flex-col gap-1">
                    <h3 class="px-3 text-xs font-semibold text-slate-400 uppercase tracking-wider mb-1">Quick Tools</h3>
                    <button
                        class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 w-full text-left transition-colors">
                        <span class="material-symbols-outlined text-orange-500" style="font-size: 20px;">bolt</span>
                        <p class="text-sm font-medium">Emission Factors</p>
                    </button>
                    <button
                        class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 w-full text-left transition-colors">
                        <span class="material-symbols-outlined text-blue-500"
                            style="font-size: 20px;">trending_up</span>
                        <p class="text-sm font-medium">Trajectory Calc</p>
                    </button>
                    <button
                        class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 w-full text-left transition-colors">
                        <span class="material-symbols-outlined text-purple-500"
                            style="font-size: 20px;">folder_open</span>
                        <p class="text-sm font-medium">Report Templates</p>
                    </button>
                </div>
            </div>
            <!-- Bottom Settings -->
            <div class="p-3 border-t border-slate-200 dark:border-slate-800">
                <button
                    class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 w-full text-left transition-colors">
                    <span class="material-symbols-outlined" style="font-size: 20px;">settings</span>
                    <p class="text-sm font-medium">Settings</p>
                </button>
                <button
                    class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-400 w-full text-left transition-colors">
                    <span class="material-symbols-outlined" style="font-size: 20px;">help</span>
                    <p class="text-sm font-medium">Help &amp; Support</p>
                </button>
            </div>
        </aside>
        <!-- Main Chat Area -->
        <main class="flex-1 flex flex-col relative min-w-0">
            <!-- Messages Container -->
            <div id="messages-container" class="flex-1 overflow-y-auto space-y-4 scroll-smooth pb-32">
                <!-- Welcome/Start (Context) -->
                <div class="flex justify-center pb-4">
                    <span
                        class="px-3 py-1 bg-slate-100 dark:bg-slate-800 text-slate-500 text-xs rounded-full font-medium">Today</span>
                </div>
                <!-- åŠ¨æ€æ¶ˆæ¯å°†æ’å…¥è¿™é‡Œ -->
            </div>
            <!-- Input Area (Fixed Bottom) -->
            <div id="input-area"
                class="absolute bottom-0 left-0 w-full p-4 md:p-6 bg-gradient-to-t from-white via-white to-transparent dark:from-background-dark dark:via-background-dark">
                <div class="max-w-4xl mx-auto w-full">
                    <div
                        class="relative bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 shadow-lg rounded-2xl flex flex-col transition-all focus-within:ring-2 focus-within:ring-primary/20 focus-within:border-primary">
                        <!-- Text Area -->
                        <textarea
                            class="w-full bg-transparent text-slate-800 dark:text-slate-200 placeholder-slate-400 text-base p-4 focus:outline-none resize-none rounded-2xl min-h-[56px] max-h-[200px]"
                            oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"
                            placeholder="Ask about emission factors or upload more data..." rows="1"></textarea>
                        <!-- Toolbar -->
                        <div class="flex items-center justify-between px-2 pb-2">
                            <div class="flex items-center gap-1">
                                <button
                                    class="p-2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors tooltip-trigger"
                                    title="Attach file">
                                    <span class="material-symbols-outlined" style="font-size: 22px;">attach_file</span>
                                </button>
                                <button
                                    class="p-2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors hidden sm:block">
                                    <span class="material-symbols-outlined"
                                        style="font-size: 22px;">format_list_bulleted</span>
                                </button>
                            </div>
                            <button
                                class="flex items-center justify-center p-2 bg-primary hover:bg-primary-dark text-white rounded-xl shadow-sm transition-transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                                <span class="material-symbols-outlined" style="font-size: 20px;">arrow_upward</span>
                            </button>
                        </div>
                    </div>
                    <p class="text-center text-xs text-slate-400 mt-3">
                        AI can make mistakes. Please verify important emission calculations.
                    </p>
                </div>
            </div>
        </main>
    </div>
    <script src="app.js?v=12"></script>
</body>

</html>
